<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AZoom Car Rental Office</title>
    <link rel="icon" href="images/favicon.ico" type="image/x-icon">
    <!-- CSS -->
    <link href="style/main.css" rel="stylesheet">
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Font Awesome Link -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css">
</head>

<body>
    <div class="nav-container">
        <a href="index.html" class="logo" id="home"><b>AZoom Rental</b></a>
        <nav>
            <!-- <a href="about.html">About Us</a> -->
            <a href="reserve-car.html" id="reserve_car">Reserve Car</a>
            <a href="contact.html">Contact Us</a>
            <div class="dropdown" style="float: right;">
                <button class="dropbtn">
                    <i class="fa-solid fa-user"></i>
                </button>
                <div class="dropdown-content">
                    <a href="login.html" id="member_login">Member Login</a>
                    <a href="signup.html" id="member_register">Register</a>
                </div>
            </div>
        </nav>
    </div>
    <section id="form-main">
        <div class="row align-items-center">
            <div class="col-md-5 col-12" style="text-align: center; align-items: center;">
                <img id="car-image" src="" alt="Car Image" class="reserve-car-img">
            </div>
            <div class="col-md-7 col-12">
                <div>
                    <h4 style="padding-left: 10px;">Reservation for <span id="car-name"></span></h4>
                    <div class="row">
                        <div class="col-12" style="margin-bottom: 20px;">
                            <span>$<span id="daily_rate"></span>/day</span>
                        </div>
                        <div class="col-12">
                            <label style="font-size: 13px; color: #B4B6B7;">Credit Card Number</label>
                            <div class="select-icon">
                                <i class="fa-solid fa-credit-card"></i>
                                <input id="creditcard" placeholder="1234 5678 9012 3456" maxlength="19" />
                            </div>
                        </div>
                        <div  class="col-lg-6 col-md-12">
                            <label style="font-size: 13px; color: #B4B6B7;">Pickup Date & Time</label>
                            <div class="select-icon">
                                <i class="fa-solid fa-male"></i>
                                <input id="pickup" type="datetime-local" onload="setCurrentDateTime()"
                                    onchange="calculatePrice()" />
                            </div>
                        </div>
                        <div  class="col-lg-6 col-md-12">
                            <label style="font-size: 13px; color: #B4B6B7;">Return Date & Time</label>
                            <div class="select-icon">
                                <i class="fa-solid fa-male"></i>
                                <input id="return" type="datetime-local" onchange="calculatePrice()" />
                            </div>
                        </div>

                        <div  class="col-lg-6 col-md-12">
                            <label style="font-size: 13px; color: #B4B6B7;">Pickup Branch</label>
                            <div class="select-icon">
                                <i class="fa-solid fa-map-pin"></i>
                                <select id="pickupLocation">
                                    <option value="123 Jurong Road, #02-45, Singapore 609123">123 Jurong Road, #02-45,
                                        Singapore 609123</option>
                                    <option value="88 East Coast Avenue, #01-10, Singapore 459088">88 East Coast Avenue,
                                        #01-10, Singapore 459088</option>
                                </select>
                            </div>
                        </div>
                        <div  class="col-lg-6 col-md-12">
                            <label style="font-size: 13px; color: #B4B6B7;">Return Carpark</label>
                            <div class="select-icon">
                                <i class="fa-solid fa-car"></i>
                                <select id="returnLocation">
                                    <option value="123 Jurong Road, #02-45, Singapore 609123">123 Jurong Road, #02-45,
                                        Singapore 609123</option>
                                    <option value="88 East Coast Avenue, #01-10, Singapore 459088">88 East Coast Avenue,
                                        #01-10, Singapore 459088</option>
                                    <option value="Changi Airport Terminal 3">Changi Airport Terminal 3</option>
                                    <option value="Singapore Downtown - 390A Havelock Rd">Singapore Downtown - 390A
                                        Havelock Rd</option>
                                    <option value="Jurong West - 233 Jurong West Str">Jurong West - 233 Jurong West Str
                                    </option>
                                    <option value="Woodlands - 884 Woodlands Ave 1">Woodlands - 884 Woodlands Ave 1
                                    </option>
                                </select>
                            </div>
                        </div>

                        <h4 style="padding-left: 10px; margin-top: 50px;">Add-ons</h4>
                        <div class="add-on col-12">
                            <p style="margin-bottom: 0; font-size: 16px;"><b>Insurance Option</b></p>
                            <input type="checkbox" class="add-on-checkbox" data-addon="insurance" /><span>Reduce excess
                                from $4,500 to $2,500
                                -- <b>$15/day</b></span>

                            <p style="margin-bottom: 0; margin-top: 1rem; font-size: 16px;"><b>Others</b></p>
                            <input type="checkbox" class="add-on-checkbox" data-addon="childSeat" /><span>Child Seat --
                                <b>$15/day</b></span>
                            <br>
                            <input type="checkbox" class="add-on-checkbox" data-addon="malaysia" /><span>Drive to
                                Malaysia --
                                <b>$50/day</b></span>
                        </div>
                        <hr>
                        <div class="col-12">
                            <i class="fa-solid fa-exclamation-circle" style="color: #ff335f; font-size: 15px;"></i>
                            <span style="color: #ff335f; padding-left: 10px;">
                                Please return car by
                                <span id="return_car_time"></span>
                            </span>
                        </div>
                        <div class="col-12" style="margin-bottom: 10px;">
                            <i class="fa-solid fa-exclamation-circle" style="color: #ff335f; font-size: 15px;"></i>
                            <span style="color: #ff335f; padding-left: 10px;">
                                Exact 24 hours is considered as 1 day
                            </span>
                        </div>

                        <div class="col-12" style="text-align: left; padding-right: 20px; margin-bottom: 20px;">
                            <span>Number of Days: <span id="total_days">0</span> day(s)</span>
                            <h5 style="margin-top: 5px;">Total: $<span id="total_payment_cost">0.00</span></h5>
                        </div>
                        <div class="col-md-6 col-12" style="text-align: left; padding-right: 20px;">
                            <a href="#" class="text-primary" data-bs-toggle="modal" data-bs-target="#termsModal">
                                Rental Terms & Conditions
                            </a>
                        </div>
                        <div class="reserve-btn-div col-md-6 col-12">
                            <button id="reserve_and_pay" class="car-btn" onclick="carReservation()">
                                <span>
                                    <i class="fa fa-credit-card" style="padding-right: 10px;"></i>
                                    Reserve with CC
                                </span>
                            </button>
                        </div>
                    </div>

                </div>

            </div>
        </div>
    </section>

    <!-- Terms & Conditions Modal -->
    <div class="modal fade" id="termsModal" tabindex="-1" aria-labelledby="termsModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="termsModalLabel">Rental Terms & Conditions</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>Driver must be 21+ with a valid license.</p>
                    <p>International customers must provide a valid passport and an International Driving Permit (IDP)
                        if required.</p>
                    <p>The rented vehicle must only be used for personal or business travel within the allowed
                        locations.</p>
                    <p>No off-road driving, racing, or illegal activities.</p>
                    <p>Return with at least 20% charge.</p>
                    <p>Extra charges apply for late returns and damages.</p>
                    <p>more...</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    

    <section id="footer">
        <div class="row">
            <div class="footer-row col-md-4 col-12">
                <b>AZoom Rental</b> <br>
                <p>A Trusted Service at your fingertip.</p>
            </div>
            <div class="footer-row col-md-4 col-12">
                <h4>Resources</h4>
                <p>Reserve a Car</p>
                <p>Manage Account</p>
                <p>Help</p>
            </div>
            <div class="footer-row col-md-4 col-12">
                <h4>Contact</h4>
                <p>Email: info@azoomcarrental.com</p>
            </div>
            <div class="footer-row-2 col-md-6 col-12" style="margin-top: 20px; text-align: left;">
                <span>Terms of Service &emsp; Privacy Policy</span>
            </div>
            <div class="footer-row-3 col-md-6 col-12" style="margin-top: 20px; text-align: center;">
                <span>&copy; 2025 AZoom Car Rental - All Rights Reserved.</span>
            </div>
        </div>
    </section>

    <!-- JavaScript -->
    <script src="script/main.js"></script>
    <script>
        const addons = {
            insurance: 15, // $15/day
            childSeat: 15,  // $15/day
            malaysia: 50,   // $50/day
        };
        const receipt_no = generateReceiptNumber();
        document.addEventListener("DOMContentLoaded", function () {
            const urlParams = new URLSearchParams(window.location.search);

            fetch("data/carDetails.json")
                .then(response => response.json())
                .then(cars => {
                    const car = cars.find(car => car.id == id);
                    if (car) {
                        // Display the car details
                        const carImage = document.getElementById('car-image');
                        document.getElementById('car-name').textContent = car.name;
                        document.getElementById('daily_rate').textContent = `${car.daily_rate}.00`;
                        carImage.src = car.image;
                        carImage.alt = car.name;
                        window.selectedCar = car;
                    }
                    else {
                        document.getElementById("car-detail").innerHTML = "<p>Car not found</p>";
                    }
                });

            var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
            var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
                return new bootstrap.Tooltip(tooltipTriggerEl);
            });
        });

        function setCurrentDateTime() {
            var now = new Date();

            // Convert to Singapore time (UTC +8)
            now = new Date(now.getTime() + (8 * 60 * 60 * 1000));

            const localDatetime = now.toISOString().slice(0, 16); // Convert to YYYY-MM-DDTHH:MM format
            const datetime = document.getElementById("pickup");
            datetime.value = localDatetime;
        }

        function formatDateTime(date) {
            let day = String(date.getDate()).padStart(2, '0');
            let month = String(date.getMonth() + 1).padStart(2, '0'); // Months are 0-based
            let year = date.getFullYear();

            let hours = date.getHours();
            let minutes = String(date.getMinutes()).padStart(2, '0');
            let ampm = hours >= 12 ? 'PM' : 'AM';
            hours = hours % 12 || 12; // Convert 24-hour to 12-hour format

            return `${day}/${month}/${year} ${hours}:${minutes} ${ampm}`;
        }

        function calculatePrice() {
            const pickupInput = document.getElementById("pickup");
            const returnInput = document.getElementById("return");
            const returnCar = document.getElementById("return_car_time");
            const totalDaysElement = document.getElementById("total_days");
            const totalCostElement = document.getElementById("total_payment_cost");
            const totalPayCostElement = document.getElementById("total_payment_cost");

            const pickupDate = new Date(pickupInput.value);
            const returnDate = new Date(returnInput.value);

            // Clear previous values if the input is invalid
            if (isNaN(pickupDate.getTime()) || isNaN(returnDate.getTime()) || returnDate <= pickupDate) {
                alert("Car return must be at least 1 day after pickup!");

                returnInput.value = ""; // Clear return date field
                returnCar.textContent = ""; // Clear displayed return time
                totalDaysElement.textContent = "0"; // Reset total days
                totalCostElement.textContent = "0.00"; // Reset total cost
                totalPayCostElement.textContent = "0"; // Reset total cost
            }
            else {
                // Calculate rental duration
                const timeDiff = returnDate - pickupDate;
                const days = Math.ceil(timeDiff / (1000 * 60 * 60 * 24)); // Convert ms to days


                // Display formatted return date
                returnCar.textContent = formatDateTime(returnDate);

                if (days > 0) {
                    // Calculate add-on total
                    let addonTotal = 0;
                    document.querySelectorAll(".add-on-checkbox").forEach((checkbox) => {
                        if (checkbox.checked) {
                            addonTotal += addons[checkbox.dataset.addon] * days; // Multiply by days
                        }
                    });

                    const totalPrice = days * (window.selectedCar ? window.selectedCar.daily_rate : 0) + addonTotal;
                    // Update total days and total cost
                    totalDaysElement.textContent = days;
                    totalCostElement.textContent = totalPrice + ".00";
                    totalPayCostElement.textContent = totalPrice + ".00";
                }

                else {
                    alert("Please select car pickup and return date first.")
                }

            }
        }

        function generateReceiptNumber() {
            return `RC-${Date.now()}-${Math.floor(Math.random() * 1000)}`;
        }



        function carReservation() {
            const car_id = id;
            const car_name = document.getElementById("car-name").textContent;
            const user = username;
            const pickup_date_time = document.getElementById("pickup").value;
            const return_date_time = document.getElementById("return").value;
            const pickup_location = document.getElementById("pickupLocation").value;
            const return_location = document.getElementById("returnLocation").value;
            const rental_days = document.getElementById("total_days").textContent;
            const rentalCostText = document.getElementById("total_payment_cost").textContent.trim();
            const ready_for_payment = "No";
            const add_reason = "";
            const add_cost = 0;
            const payment_status = "Unpaid";

            const credit_card = document.getElementById("creditcard").value.replace(/\s/g, "");
            const rental_cost = parseFloat(rentalCostText.replace(/\.00$/, '')); 

            console.log(car_name);
            if (credit_card.length !== 16) {
                alert("Please enter valid credit card.");
                return;
            }

            else if (rental_days <= 0) {
                alert("Please select both pickup and return date!")
                return;
            }

            else {
                const reservation = {
                    receipt_no,
                    car_id,
                    car_name,
                    user,
                    credit_card,
                    pickup_date_time,
                    return_date_time,
                    pickup_location,
                    return_location,
                    rental_days,
                    rental_cost,
                    ready_for_payment,
                    add_reason,
                    add_cost,
                    payment_status
                }

                let history = JSON.parse(localStorage.getItem("rentalHistory")) || [];
                history.push(reservation);
                localStorage.setItem("rentalHistory", JSON.stringify(history));
                alert("Reservation saved successfully!");

                window.location.href = `confirmation.html?id=${encodeURIComponent(id)}&username=${encodeURIComponent(username)}&receiptNo=${encodeURIComponent(receipt_no)}`;
            }
        }

        

        document.querySelectorAll(".add-on-checkbox").forEach((checkbox) => {
            checkbox.addEventListener("change", calculatePrice);
        });

        window.onload = function () {
            setCurrentDateTime();
        };
    </script>
</body>

</html>